@using RainingCatsAndDogsOnWeb.Web.ViewModels.Ads
@model SingleAdViewModel

@{
    ViewData["Title"] = @Model.Title;
}

<div class="homes">
    <img src="@Model.ImageUrl" class="img-fluid w-100">
</div>

<div class="homes-content">
    <h3>@Model.Title</h3>
    <i class="fa fa-user" aria-hidden="true"></i>
    <p> Added by: @Model.AddedByUserFirstName @Model.AddedByUserLastName on @Model.CreatedOn.ToString("D")</p>
    <p class="homes-address mb-3">
        <a href="https://www.google.com/maps/place/Bulgaria">
            <i class="fa fa-map-marker" aria-hidden="true"></i>
            <span>@Model.Location</span>
        </a>
    </p>
    <i class="fa-solid fa-phone"></i>
    <span>@Model.PhoneNumber</span>

    <br>

    <div>
        <br />
        <span class="h5" style="background-color:powderblue">Description: </span>
        <p>@Model.Description</p>
    </div>

    <ul class="homes-list clearfix">
        @if (User.Identity.Name == Model.AddedByUserUserName)
        {
            <li>
                <i class="fa fa-comments" aria-hidden="true"></i>
                <span>0 Comments</span>
            </li>
        }
        else
        {
            <li>
                <i class="fa fa-thumbs-up" aria-hidden="true"></i>
                <span id="likesField">@Model.LikesCount Likes</span>
            </li>

            <li>
                <i class="fa fa-comments" aria-hidden="true"></i>
                <span>0 Comments</span>
            </li>
            <br />
            <button class="btn btn-block btn-primary" id="btnLike"><i class="fa fa-thumbs-up">Like</i> </button>
        }

    </ul>
    <div class="price-properties">
        <h3 class="title mt-3">
        </h3>
        <p class="h3">Price: @Model.Price лв.</p>
    </div>

</div>

@section Scripts {
    <script>
        let likes = $("#likesField span").text();

        $('#btnLike').click(function () {
            likes++;
            $('#btnLike').attr('disabled', true);
            let adid = @Model.Id;
            let data = { adid: adid, likesCount: likes }

            $.ajax( {
                type: "POST",
                url: "/api/Likes",
                data: JSON.stringify(data),
                success: function(data) {
                   $("#likesField").html(`${likes} Likes`);
                },
                contentType: "application/json"
            });
        });
    </script>

}


